!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("pub-sub-es"),require("regl")):"function"==typeof define&&define.amd?define(["exports","pub-sub-es","regl"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).createScatterplot={},n.createPubSub,n.createREGL)}(this,(function(n,e,t){"use strict";function o(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var r=o(e),i=o(t);function a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,o)}return t}function c(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?a(Object(t),!0).forEach((function(e){l(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function l(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function u(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null==t)return;var o,r,i=[],a=!0,c=!1;try{for(t=t.call(n);!(a=(o=t.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(n){c=!0,r=n}finally{try{a||null==t.return||t.return()}finally{if(c)throw r}}return i}(n,e)||d(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(n){return function(n){if(Array.isArray(n))return f(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||d(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(n,e){if(n){if("string"==typeof n)return f(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(n,e):void 0}}function f(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}var p,v="undefined"!=typeof Float32Array?Float32Array:Array;function h(){var n=new v(16);return v!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function m(n){var e=new v(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function y(n,e){var t=e[0],o=e[1],r=e[2],i=e[3],a=e[4],c=e[5],l=e[6],u=e[7],s=e[8],d=e[9],f=e[10],p=e[11],v=e[12],h=e[13],m=e[14],y=e[15],g=t*c-o*a,w=t*l-r*a,x=t*u-i*a,b=o*l-r*c,S=o*u-i*c,M=r*u-i*l,A=s*h-d*v,E=s*m-f*v,C=s*y-p*v,I=d*m-f*h,P=d*y-p*h,R=f*y-p*m,T=g*R-w*P+x*I+b*C-S*E+M*A;return T?(T=1/T,n[0]=(c*R-l*P+u*I)*T,n[1]=(r*P-o*R-i*I)*T,n[2]=(h*M-m*S+y*b)*T,n[3]=(f*S-d*M-p*b)*T,n[4]=(l*C-a*R-u*E)*T,n[5]=(t*R-r*C+i*E)*T,n[6]=(m*x-v*M-y*w)*T,n[7]=(s*M-f*x+p*w)*T,n[8]=(a*P-c*C+u*A)*T,n[9]=(o*C-t*P-i*A)*T,n[10]=(v*S-h*x+y*g)*T,n[11]=(d*x-s*S-p*g)*T,n[12]=(c*E-a*I-l*A)*T,n[13]=(t*I-o*E+r*A)*T,n[14]=(h*w-v*b-m*g)*T,n[15]=(s*b-d*w+f*g)*T,n):null}function g(n,e,t){var o=e[0],r=e[1],i=e[2],a=e[3],c=e[4],l=e[5],u=e[6],s=e[7],d=e[8],f=e[9],p=e[10],v=e[11],h=e[12],m=e[13],y=e[14],g=e[15],w=t[0],x=t[1],b=t[2],S=t[3];return n[0]=w*o+x*c+b*d+S*h,n[1]=w*r+x*l+b*f+S*m,n[2]=w*i+x*u+b*p+S*y,n[3]=w*a+x*s+b*v+S*g,w=t[4],x=t[5],b=t[6],S=t[7],n[4]=w*o+x*c+b*d+S*h,n[5]=w*r+x*l+b*f+S*m,n[6]=w*i+x*u+b*p+S*y,n[7]=w*a+x*s+b*v+S*g,w=t[8],x=t[9],b=t[10],S=t[11],n[8]=w*o+x*c+b*d+S*h,n[9]=w*r+x*l+b*f+S*m,n[10]=w*i+x*u+b*p+S*y,n[11]=w*a+x*s+b*v+S*g,w=t[12],x=t[13],b=t[14],S=t[15],n[12]=w*o+x*c+b*d+S*h,n[13]=w*r+x*l+b*f+S*m,n[14]=w*i+x*u+b*p+S*y,n[15]=w*a+x*s+b*v+S*g,n}function w(n,e){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function x(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function b(n,e,t){var o=e[0],r=e[1],i=e[2],a=e[3];return n[0]=t[0]*o+t[4]*r+t[8]*i+t[12]*a,n[1]=t[1]*o+t[5]*r+t[9]*i+t[13]*a,n[2]=t[2]*o+t[6]*r+t[10]*i+t[14]*a,n[3]=t[3]*o+t[7]*r+t[11]*i+t[15]*a,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)}),p=new v(4),v!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0,p[3]=0),function(){var n=function(){var n=new v(2);return v!=Float32Array&&(n[0]=0,n[1]=0),n}()}();const S=(n=[0,0],e=1,t=0,o=[0,0],r=[[0,1/0],[0,1/0]],i=[[-1/0,1/0],[-1/0,1/0]])=>{const a=new Float32Array(16),c=new Float32Array(16),l=new Float32Array(16);let u=h(),s=[...o.slice(0,2),0,1];const d=Array.isArray(r[0])?[...r[0]]:[...r],f=Array.isArray(r[0])?[...r[1]]:[...r],p=Array.isArray(i[0])?[...i[0]]:[...i],v=Array.isArray(i[0])?[...i[1]]:[...i],m=()=>function(n,e){var t=e[0],o=e[1],r=e[2],i=e[4],a=e[5],c=e[6],l=e[8],u=e[9],s=e[10];return n[0]=Math.hypot(t,o,r),n[1]=Math.hypot(i,a,c),n[2]=Math.hypot(l,u,s),n}(a,u).slice(0,2),S=()=>{const n=m();return Math.min(n[0],n[1])},M=()=>{const n=m();return Math.max(n[0],n[1])},A=([n=0,e=0]=[],t=1,o=0)=>{u=h(),E([-n,-e]),I(o),C(1/t)},E=([n=0,e=0]=[])=>{a[0]=n,a[1]=e,a[2]=0;const t=w(c,a);g(u,t,u)},C=(n,e)=>{const t=Array.isArray(n);let o=t?n[0]:n,r=t?n[1]:n;if(o<=0||r<=0||1===o&&1===r)return;const i=m(),p=i[0]*o,v=i[1]*r;if(o=Math.max(d[0],Math.min(p,d[1]))/i[0],r=Math.max(f[0],Math.min(v,f[1]))/i[1],1===o&&1===r)return;a[0]=o,a[1]=r,a[2]=1;const h=x(c,a),b=e?[...e,0]:s,S=w(a,b);g(u,S,g(u,h,g(u,y(l,S),u)))},I=n=>{const e=h();!function(n,e,t){var o,r,i,a=t[0],c=t[1],l=t[2],u=Math.hypot(a,c,l);u<1e-6||(a*=u=1/u,c*=u,l*=u,o=Math.sin(e),i=1-(r=Math.cos(e)),n[0]=a*a*i+r,n[1]=c*a*i+l*o,n[2]=l*a*i-c*o,n[3]=0,n[4]=a*c*i-l*o,n[5]=c*c*i+r,n[6]=l*c*i+a*o,n[7]=0,n[8]=a*l*i+c*o,n[9]=c*l*i-a*o,n[10]=l*l*i+r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1)}(e,n,[0,0,1]),g(u,e,u)},P=n=>{!n||n.length<16||(u=n)};return A(n,e,t),{get translation(){return function(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}(a,u).slice(0,2)},get target(){return b(a,s,y(l,u)).slice(0,2)},get scaling(){return m()},get minScaling(){return S()},get maxScaling(){return M()},get scaleBounds(){return[[...d],[...f]]},get translationBounds(){return[[...p],[...v]]},get distance(){return(()=>{const n=m();return[1/n[0],1/n[1]]})()},get minDistance(){return 1/S()},get maxDistance(){return 1/M()},get rotation(){return Math.acos(u[0]/M())},get view(){return u},get viewCenter(){return s.slice(0,2)},lookAt:A,translate:E,pan:E,rotate:I,scale:C,zoom:C,reset:()=>{A(n,e,t)},set:(...n)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),P(...n)),setScaleBounds:n=>{const e=Array.isArray(n[0]);d[0]=e?n[0][0]:n[0],d[1]=e?n[0][1]:n[1],f[0]=e?n[1][0]:n[0],f[1]=e?n[1][1]:n[1]},setTranslationBounds:n=>{const e=Array.isArray(n[0]);p[0]=e?n[0][0]:n[0],p[1]=e?n[0][1]:n[1],v[0]=e?n[1][0]:n[0],v[1]=e?n[1][1]:n[1]},setView:P,setViewCenter:n=>{s=[...n.slice(0,2),0,1]}}},M=["pan","rotate"],A={alt:"altKey",cmd:"metaKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},E=(n,{distance:e=1,target:t=[0,0],rotation:o=0,isNdc:r=!0,isFixed:i=!1,isPan:a=!0,isPanInverted:c=[!1,!0],panSpeed:l=1,isRotate:u=!0,rotateSpeed:s=1,defaultMouseDownMoveAction:d="pan",mouseDownMoveModKey:f="alt",isZoom:p=!0,zoomSpeed:v=1,viewCenter:h,scaleBounds:m,translationBounds:y,onKeyDown:g=(()=>{}),onKeyUp:w=(()=>{}),onMouseDown:x=(()=>{}),onMouseUp:b=(()=>{}),onMouseMove:E=(()=>{}),onWheel:C=(()=>{})}={})=>{let I=S(t,e,o,h,m,y),P=0,R=0,T=0,O=0,B=0,D=0,z=!1,L=0,j=1,k=1,F=1,_=!1,N=!1,V=!1,W="pan"===d,Z=a,q=a,G=c,H=c,K=p,U=p;const Y=()=>{Z=Array.isArray(a)?Boolean(a[0]):a,q=Array.isArray(a)?Boolean(a[1]):a,G=Array.isArray(c)?Boolean(c[0]):c,H=Array.isArray(c)?Boolean(c[1]):c,K=Array.isArray(p)?Boolean(p[0]):p,U=Array.isArray(p)?Boolean(p[1]):p};Y();const X=r?n=>n/j*2*F:n=>n,$=r?n=>n/k*2:n=>-n,J=r?n=>(n/j*2-1)*F:n=>n,Q=r?n=>1-n/k*2:n=>n,nn=()=>{const e=n.getBoundingClientRect();j=e.width,k=e.height,F=j/k},en=n=>{V=!1,w(n)},tn=n=>{V=n[A[f]],g(n)},on=n=>{z=!1,b(n)},rn=n=>{z=1===n.buttons,x(n)},an=void 0!==document.createEvent("MouseEvent").offsetX?n=>{T=n.offsetX,O=n.offsetY}:e=>{const t=n.getBoundingClientRect();T=e.clientX-t.left,O=e.clientY-t.top},cn=n=>{P=n.clientX,R=n.clientY},ln=n=>{cn(n),E(n)},un=n=>{n.preventDefault(),cn(n),an(n);const e=1===n.deltaMode?12:1;L+=e*(n.deltaY||0),C(n)};window.addEventListener("keydown",tn,{passive:!0}),window.addEventListener("keyup",en,{passive:!0}),n.addEventListener("mousedown",rn,{passive:!0}),window.addEventListener("mouseup",on,{passive:!0}),window.addEventListener("mousemove",ln,{passive:!0}),n.addEventListener("wheel",un,{passive:!1}),I.config=({defaultMouseDownMoveAction:n=null,isFixed:e=null,isPan:t=null,isPanInverted:o=null,isRotate:r=null,isZoom:h=null,panSpeed:m=null,rotateSpeed:y=null,zoomSpeed:g=null,mouseDownMoveModKey:w=null}={})=>{d=null!==n&&M.includes(n)?n:d,W="pan"===d,i=null!==e?e:i,a=null!==t?t:a,c=null!==o?o:c,u=null!==r?r:u,p=null!==h?h:p,l=+m>0?m:l,s=+y>0?y:s,v=+g>0?g:v,Y(),f=null!==w&&Object.keys(A).includes(w)?w:f},I.dispose=()=>{I=void 0,window.removeEventListener("keydown",tn),window.removeEventListener("keyup",en),n.removeEventListener("mousedown",rn),window.removeEventListener("mouseup",on),window.removeEventListener("mousemove",ln),n.removeEventListener("wheel",un)},I.refresh=nn,I.tick=()=>{if(i)return!1;_=!1;const n=P,e=R;if((Z||q)&&z&&(W&&!V||!W&&V)){const t=G?B-n:n-B,o=Z?X(l*t):0,r=H?D-e:e-D,i=q?$(l*r):0;0===o&&0===i||(I.pan([o,i]),_=!0)}if(p&&L){const n=v*Math.exp(L/k),e=J(T),t=Q(O);I.scale([K?1/n:1,U?1/n:1],[e,t]),_=!0}if(u&&z&&(W&&V||!W&&!V)&&Math.abs(B-n)+Math.abs(D-e)>0){const t=j/2,o=k/2,r=B-t,i=o-D,a=n-t,c=o-e,l=function(n,e){var t=n[0],o=n[1],r=e[0],i=e[1],a=Math.sqrt(t*t+o*o)*Math.sqrt(r*r+i*i),c=a&&(t*r+o*i)/a;return Math.acos(Math.min(Math.max(c,-1),1))}([r,i],[a,c]),u=r*c-a*i;I.rotate(s*l*Math.sign(u)),_=!0}L=0,B=n,D=e;const t=_||N;return N=!1,t};const sn=n=>function(){n.apply(null,arguments),N=!0};return I.lookAt=sn(I.lookAt),I.translate=sn(I.translate),I.pan=sn(I.pan),I.rotate=sn(I.rotate),I.scale=sn(I.scale),I.zoom=sn(I.zoom),I.reset=sn(I.reset),I.set=sn(I.set),I.setScaleBounds=sn(I.setScaleBounds),I.setTranslationBounds=sn(I.setTranslationBounds),I.setView=sn(I.setView),I.setViewCenter=sn(I.setViewCenter),nn(),I};function C(n,e,t,o,r,i){if(r-o<=t)return;const a=o+r>>1;I(n,e,a,o,r,i%2),C(n,e,t,o,a-1,i+1),C(n,e,t,a+1,r,i+1)}function I(n,e,t,o,r,i){for(;r>o;){if(r-o>600){const a=r-o+1,c=t-o+1,l=Math.log(a),u=.5*Math.exp(2*l/3),s=.5*Math.sqrt(l*u*(a-u)/a)*(c-a/2<0?-1:1);I(n,e,t,Math.max(o,Math.floor(t-c*u/a+s)),Math.min(r,Math.floor(t+(a-c)*u/a+s)),i)}const a=e[2*t+i];let c=o,l=r;for(P(n,e,o,t),e[2*r+i]>a&&P(n,e,o,r);c<l;){for(P(n,e,c,l),c++,l--;e[2*c+i]<a;)c++;for(;e[2*l+i]>a;)l--}e[2*o+i]===a?P(n,e,o,l):(l++,P(n,e,l,r)),l<=t&&(o=l+1),t<=l&&(r=l-1)}}function P(n,e,t,o){R(n,t,o),R(e,2*t,2*o),R(e,2*t+1,2*o+1)}function R(n,e,t){const o=n[e];n[e]=n[t],n[t]=o}function T(n,e,t,o){const r=n-t,i=e-o;return r*r+i*i}const O=n=>n[0],B=n=>n[1];class D{constructor(n,e=O,t=B,o=64,r=Float64Array){this.nodeSize=o,this.points=n;const i=n.length<65536?Uint16Array:Uint32Array,a=this.ids=new i(n.length),c=this.coords=new r(2*n.length);for(let o=0;o<n.length;o++)a[o]=o,c[2*o]=e(n[o]),c[2*o+1]=t(n[o]);C(a,c,o,0,a.length-1,0)}range(n,e,t,o){return function(n,e,t,o,r,i,a){const c=[0,n.length-1,0],l=[];let u,s;for(;c.length;){const d=c.pop(),f=c.pop(),p=c.pop();if(f-p<=a){for(let a=p;a<=f;a++)u=e[2*a],s=e[2*a+1],u>=t&&u<=r&&s>=o&&s<=i&&l.push(n[a]);continue}const v=Math.floor((p+f)/2);u=e[2*v],s=e[2*v+1],u>=t&&u<=r&&s>=o&&s<=i&&l.push(n[v]);const h=(d+1)%2;(0===d?t<=u:o<=s)&&(c.push(p),c.push(v-1),c.push(h)),(0===d?r>=u:i>=s)&&(c.push(v+1),c.push(f),c.push(h))}return l}(this.ids,this.coords,n,e,t,o,this.nodeSize)}within(n,e,t){return function(n,e,t,o,r,i){const a=[0,n.length-1,0],c=[],l=r*r;for(;a.length;){const u=a.pop(),s=a.pop(),d=a.pop();if(s-d<=i){for(let r=d;r<=s;r++)T(e[2*r],e[2*r+1],t,o)<=l&&c.push(n[r]);continue}const f=Math.floor((d+s)/2),p=e[2*f],v=e[2*f+1];T(p,v,t,o)<=l&&c.push(n[f]);const h=(u+1)%2;(0===u?t-r<=p:o-r<=v)&&(a.push(d),a.push(f-1),a.push(h)),(0===u?t+r>=p:o+r>=v)&&(a.push(f+1),a.push(s),a.push(h))}return c}(this.ids,this.coords,n,e,t,this.nodeSize)}}const{push:z,splice:L}=Array.prototype,j=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),k=Float32Array.BYTES_PER_ELEMENT,F={duplicate(n,e=1,t=1){const o=[],r=new Array(2*e);for(let i=0,a=n.length/e;i<a;i++){const a=i*e;for(let o=0;o<e;o++){const i=n[a+o];r[o]=i,r[o+e]=i*t}z.apply(o,r)}return o},mapElement(n,e,t,o){for(let r=0,i=n.length/t;r<i;r++){const i=e+r*t;n[i]=o(n[i],i,r)}return n},copyElement(n,e,t,o){const r=new Array(o),i=e*o;for(let e=0;e<o;e++)r[e]=n[i+e];return L.call(n,t*o,0,...r),n},increaseStride(n,e,t,o=0){const r=[],i=new Array(t).fill(o);for(let t=0,o=n.length/e;t<o;t++){const o=t*e;for(let t=0;t<e;t++)i[t]=n[o+t];z.apply(r,i)}return r}},_=(n,{projection:e=j,model:t=j,view:o=j,points:r=[],colorIndices:i=[],color:a=[.8,.5,0,1],opacity:c=null,opacities:l=[],width:u=1,widths:s=[],miter:d=1,is2d:f=!1,zPos2d:p=0}={})=>{if(!n)return void console.error("Regl instance is undefined.");const v=new Float32Array(16);let h,m,y,w,x,b,S,M,A,E,C,I,P,R,T,O,B,D,z=f?2:3;const L=()=>+(l.length===m||null!==c),_=()=>{E=n.buffer(),C=n.buffer(),I=n.buffer(),T=n.buffer(),O={prevPosition:{buffer:()=>E,offset:0,stride:3*k},currPosition:{buffer:()=>E,offset:3*k*2,stride:3*k},nextPosition:{buffer:()=>E,offset:3*k*4,stride:3*k},opacity:{buffer:()=>C,offset:2*k,stride:k},offsetScale:{buffer:()=>I,offset:2*k,stride:k},colorIndex:{buffer:()=>T,offset:2*k,stride:k}},B=n.elements(),D=n({attributes:O,depth:{enable:!f},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projectionViewModel:(n,e)=>{const t=n.projection||e.projection,o=n.model||e.model,r=n.view||e.view;return g(v,t,g(v,r,o))},aspectRatio:({viewportWidth:n,viewportHeight:e})=>n/e,colorTex:()=>P,colorTexRes:()=>R,colorTexEps:()=>.5/R,pixelRatio:({pixelRatio:n})=>n,width:({pixelRatio:n,viewportHeight:e})=>u/e*n,useOpacity:L,useColorOpacity:()=>+!L(),miter:d},elements:()=>B,vert:"\nuniform mat4 projectionViewModel;\nuniform float aspectRatio;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform float width;\nuniform float useOpacity;\nuniform float useColorOpacity;\nuniform int miter;\n\nattribute vec3 prevPosition;\nattribute vec3 currPosition;\nattribute vec3 nextPosition;\nattribute float opacity;\nattribute float offsetScale;\nattribute float colorIndex;\n\nvarying vec4 color;\n\nvoid main() {\n  vec2 aspectVec = vec2(aspectRatio, 1.0);\n  vec4 prevProjected = projectionViewModel * vec4(prevPosition, 1.0);\n  vec4 currProjected = projectionViewModel * vec4(currPosition, 1.0);\n  vec4 nextProjected = projectionViewModel * vec4(nextPosition, 1.0);\n\n  // get 2D screen space with W divide and aspect correction\n  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;\n  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  // starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  if (currScreen == prevScreen) {\n    dir = normalize(nextScreen - currScreen);\n  }\n  // ending point uses (current - previous)\n  else if (currScreen == nextScreen) {\n    dir = normalize(currScreen - prevScreen);\n  }\n  // somewhere in middle, needs a join\n  else {\n    // get directions from (C - B) and (B - A)\n    vec2 dirA = normalize((currScreen - prevScreen));\n    if (miter == 1) {\n      vec2 dirB = normalize((nextScreen - currScreen));\n      // now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      dir = tangent;\n    } else {\n      dir = dirA;\n    }\n  }\n\n  vec2 normal = vec2(-dir.y, dir.x) * width;\n  normal.x /= aspectRatio;\n  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);\n  gl_Position = currProjected + offset;\n\n  // Get color from texture\n  float colorRowIndex = floor((colorIndex + colorTexEps) / colorTexRes);\n  vec2 colorTexIndex = vec2(\n    (colorIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n  color.a = useColorOpacity * color.a + useOpacity * opacity;\n}",frag:"\nprecision mediump float;\nvarying vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"})},N=()=>{V(),_()},V=()=>{r=null,w=null,x=null,M=null,A=null,E.destroy(),I.destroy(),B.destroy()},W=(n,e)=>{const t=e.flat(2);return t.length===m?t:t.length===h?y.map(((n,e)=>Array(n).fill(t[e]))).flat():n},Z=(n=[],{colorIndices:e=i,opacities:t=l,widths:o=s,is2d:a=f}={})=>{r=n,z=(f=a)?2:3,h=Array.isArray(r[0])?r.length:1,y=h>1?r.map((n=>Math.floor(n.length/z))):[Math.floor(r.length/z)],m=y.reduce(((n,e)=>n+e),0),i=W(i,e),l=W(l,t),s=W(s,o),r&&m>1?(()=>{1===h&&r.length%z>0&&console.warn(`The length of points (${m}) does not match the dimensions (${z}). Incomplete points are ignored.`),w=r.flat().slice(0,m*z),f&&(w=F.increaseStride(w,2,3,p)),i.length!==m&&(i=new Array(m).fill(0)),s.length!==m&&(s=new Array(m).fill(1));let n=i.slice(),e=l.length===m?l.slice():new Array(m).fill(+c),t=s.slice(),o=0;y.forEach((r=>{const i=o+r-1;F.copyElement(w,i,i,3),F.copyElement(w,o,o,3),F.copyElement(n,i,i,1),F.copyElement(n,o,o,1),F.copyElement(e,i,i,1),F.copyElement(e,o,o,1),F.copyElement(t,i,i,1),F.copyElement(t,o,o,1),o+=r+2})),x=new Float32Array(F.duplicate(w,3)),b=F.duplicate(n),S=F.duplicate(e),M=F.duplicate(t,1,-1),A=((n,e=[])=>{let t=0;return n.forEach((n=>{for(let o=0;o<n-1;o++){const n=t+2*o,r=n+1,i=n+2,a=n+3;e.push(n,r,i,i,r,a)}t+=2*(n+2)})),e})(y),E({usage:"dynamic",type:"float",length:x.length*k,data:x}),C({usage:"dynamic",type:"float",length:S.length*k,data:S}),I({usage:"dynamic",type:"float",length:M.length*k,data:M}),T({usage:"dynamic",type:"float",length:b.length*k,data:b}),B({primitive:"triangles",usage:"dynamic",type:A.length>65536?"uint32":"uint16",data:A})})():N()},q=(n,e=-1)=>Array.isArray(n)?n.length&&!Array.isArray(n[0])?e+1:q(n[0],++e):e,G=()=>{const e=0===q(a)?[a]:a;R=Math.max(2,Math.ceil(Math.sqrt(e.length)));const t=new Uint8Array(R**2*4);e.forEach(((n,e)=>{t[4*e]=Math.min(255,Math.max(0,Math.round(255*n[0]))),t[4*e+1]=Math.min(255,Math.max(0,Math.round(255*n[1]))),t[4*e+2]=Math.min(255,Math.max(0,Math.round(255*n[2]))),t[4*e+3]=Number.isNaN(+n[3])?255:Math.min(255,Math.max(0,Math.round(255*n[3])))})),P=n.texture({data:t,shape:[R,R,4]})};return _(),G(),r&&r.length>1&&Z(r),{clear:N,destroy:V,draw:({projection:n,model:i,view:a}={})=>{n&&(e=n),i&&(t=i),a&&(o=a),r&&r.length>1&&D({projection:e,model:t,view:o})},getPoints:()=>r,setPoints:Z,getData:()=>({points:x,widths:M,opacities:S,colorIndices:b}),getBuffer:()=>({points:E,widths:I,opacities:C,colorIndices:T}),getStyle:()=>({color:a,miter:d,width:u}),setStyle:({color:n,opacity:e,miter:t,width:o}={})=>{n&&((n,e=c)=>{a=n,c=e,P&&P.destroy(),G()})(n,e),t&&(d=t),+o>0&&(u=o)}}},N=n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,V=n=>n,W=(n,e=(n=>n))=>{const t=[];for(let o=0;o<n;o++)t.push(e(o,n));return t},Z=(n,e)=>{const t=[];return n.forEach((n=>{t[n]=!0})),e.forEach((n=>{t[n]=!0})),t.reduce(((n,e,t)=>(e&&n.push(t),n)),[])},q=(n,...e)=>(e.forEach((e=>{const t=Object.keys(e).reduce(((n,t)=>(n[t]=Object.getOwnPropertyDescriptor(e,t),n)),{});Object.getOwnPropertySymbols(e).forEach((n=>{const o=Object.getOwnPropertyDescriptor(e,n);o.enumerable&&(t[n]=o)})),Object.defineProperties(n,t)})),n),G=(...n)=>e=>n.reduce(((n,e)=>e(n)),e),H=n=>e=>q({__proto__:{constructor:n}},e),K=(n,e)=>t=>q(t,{get[n](){return e}}),U=(n,e,t,o)=>Math.sqrt((n-t)**2+(e-o)**2),Y=n=>new Worker(window.URL.createObjectURL(new Blob([`(${n.toString()})()`],{type:"text/javascript"}))),X=(n=1)=>new Promise((e=>{let t=0;const o=()=>requestAnimationFrame((()=>{t++,t<n?o():e()}));o()})),$=(n,e,t=null)=>{let o,r=0;t=null===t?e:t;const i=(...e)=>{clearTimeout(o),o=setTimeout((()=>{r>0&&(n(...e),r=0)}),t)};let a=!1;const c=(...t)=>{a?(r++,i(...t)):(n(...t),i(...t),a=!0,r=0,setTimeout((()=>{a=!1}),e))};return c.reset=()=>{a=!1},c.cancel=()=>{clearTimeout(o)},c.now=(...e)=>n(...e),c},J=n=>new Promise((e=>setTimeout(e,n)));var Q,nn="auto",en=Float32Array.BYTES_PER_ELEMENT,tn=["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"],on={color:[0,0,0,0],depth:1},rn="panZoom",an="lasso",cn="rotate",ln=[rn,an,cn],un=rn,sn={cubicIn:n=>n*n*n,cubicInOut:N,cubicOut:n=>--n*n*n+1,linear:n=>n,quadIn:n=>n*n,quadInOut:n=>n<.5?2*n*n:(4-2*n)*n-1,quadOut:n=>n*(2-n)},dn=N,fn="deselect",pn="lassoEnd",vn=[fn,pn],hn=[0,.666666667,1,1],mn=pn,yn="lasso",gn="rotate",wn="merge",xn=[yn,gn,wn],bn="alt",Sn="cmd",Mn="ctrl",An="meta",En="shift",Cn=[bn,Sn,Mn,An,En],In=(l(Q={},bn,gn),l(Q,En,yn),l(Q,Sn,wn),Q),Pn=nn,Rn=nn,Tn=null,On=null,Bn=null,Dn=null,zn=null,Ln=[.66,.66,.66,1],jn=[0,.55,1,1],kn=[1,1,1,1],Fn=[0,0,0,1],_n=null,Nn=[.66,.66,.66,.2],Vn=[0,.55,1,1],Wn=[1,1,1,1],Zn=[0,0],qn=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Gn=[1,1,1,.5],Hn="auto",Kn=new Set(["z","valueZ","valueA","value1","category"]),Un=new Set(["w","valueW","valueB","value2","value"]),Yn=function(n){return!!n&&tn.reduce((function(e,t){return n.hasExtension(t)?e:(console.warn("WebGL: ".concat(t," extension not supported. Scatterplot might not render properly")),!1)}),!0)},Xn=function(n){var e=n.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}),t=[];return tn.forEach((function(n){e.getExtension(n)?t.push(n):console.warn("WebGL: ".concat(n," extension not supported. Scatterplot might not render properly"))})),i.default({gl:e,extensions:t})},$n=function(n,e,t,o){return Math.sqrt(Math.pow(n-t,2)+Math.pow(e-o,2))},Jn=function(n){for(var e=1/0,t=-1/0,o=1/0,r=-1/0,i=0;i<n.length;i+=2)e=n[i]<e?n[i]:e,t=n[i]>t?n[i]:t,o=n[i+1]<o?n[i+1]:o,r=n[i+1]>r?n[i+1]:r;return[e,o,t,r]},Qn=function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(n,e,t,o){return"#".concat(e).concat(e).concat(t).concat(t).concat(o).concat(o)})).substring(1).match(/.{2}/g).map((function(n){return parseInt(n,16)/Math.pow(255,e)}))},ne=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.minLength,r=void 0===o?0:o;return Array.isArray(n)&&n.length>=r&&n.every(e)},ee=function(n){return!Number.isNaN(+n)&&+n>=0},te=function(n){return!Number.isNaN(+n)&&+n>0},oe=function(n,e){return function(t){return n.indexOf(t)>=0?t:e}},re=function(n,e){return new Promise((function(t,o){(function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(t,o){var r=new Image;e&&(r.crossOrigin="anonymous"),r.src=n,r.onload=function(){t(r)},r.onerror=function(n){o(n)}}))})(e,0!==e.indexOf(window.location.origin)&&-1===e.indexOf("base64")).then((function(e){t(n.texture(e))})).catch((function(n){o(n)}))}))},ie=function(n){return n>=0&&n<=1},ae=function(n){return Array.isArray(n)&&n.every(ie)},ce=function(n){for(var e,t,o,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=u(i,2),c=a[0],l=a[1],s=!1,d=0,f=n.length-2;d<n.length;d+=2)e=n[d],t=n[d+1],o=n[f],t>l!=(r=n[f+1])>l&&c<(o-e)*(l-t)/(r-t)+e&&(s=!s),f=d;return s},le=function(n){return"string"==typeof n||n instanceof String},ue=function(n){return Number.isInteger(n)&&n>=0&&n<=255},se=function(n){return Array.isArray(n)&&n.every(ue)},de=function(n){return Array.isArray(n)&&n.length&&(Array.isArray(n[0])||le(n[0]))},fe=function(n,e){return n>e?n:e},pe=function(n,e){return n<e?n:e},ve=function(n,e){if(4===(o=n).length&&(ae(o)||se(o))){var t=ae(n);return e&&t||!e&&!t?n:e&&!t?n.map((function(n){return n/255})):n.map((function(n){return 255*n}))}var o,r;if(3===(r=n).length&&(ae(r)||se(r))){var i=Math.pow(255,!e),a=ae(n);return[].concat(e&&a||!e&&!a?s(n):s(e&&!a?n.map((function(n){return n/255})):n.map((function(n){return 255*n}))),[i])}return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n)?function(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return[].concat(s(Qn(n,e)),[Math.pow(255,!e)])}(n,e):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),e?[1,1,1,1]:[255,255,255,255])},he=function(n){return Object.entries(n).reduce((function(n,e){var t=u(e,2),o=t[0],r=t[1];return n[r]?n[r]=[].concat(s(n[r]),[o]):n[r]=o,n}),{})},me=function(n){return.21*n[0]+.72*n[1]+.07*n[2]},ye=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.regl,t=n.canvas,o=void 0===t?document.createElement("canvas"):t,r=n.gamma,i=void 0===r?1:r;Yn(e),e||(e=Xn(o));var a=[o.width,o.height],c=e.framebuffer({width:a[0],height:a[1],colorFormat:"rgba",colorType:"float"}),l=e({vert:"\n      precision highp float;\n      attribute vec2 xy;\n      void main () {\n        gl_Position = vec4(xy, 0, 1);\n      }",frag:"\n      precision highp float;\n      uniform vec2 srcRes;\n      uniform sampler2D src;\n      uniform float gamma;\n\n      vec3 approxLinearToSRGB (vec3 rgb, float gamma) {\n        return pow(clamp(rgb, vec3(0), vec3(1)), vec3(1.0 / gamma));\n      }\n\n      void main () {\n        vec4 color = texture2D(src, gl_FragCoord.xy / srcRes);\n        gl_FragColor = vec4(approxLinearToSRGB(color.rgb, gamma), color.a);\n      }",attributes:{xy:[-4,-4,4,-4,0,4]},uniforms:{src:function(){return c},srcRes:function(){return a},gamma:function(){return i}},count:3,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}}),u=function(n){var e=n.getContext("2d");e.clearRect(0,0,n.width,n.height),e.drawImage(o,(o.width-n.width)/2,(o.height-n.height)/2,n.width,n.height,0,0,n.width,n.height)},s=function(n,t){e.clear(on),c.use((function(){e.clear(on),n(t.width/o.width,t.height/o.height)})),l(),u(t)},d=function(){e.poll()},f=new Set,p=function(n){return f.add(n),function(){f.delete(n)}},v=e.frame((function(){for(var n=f.values(),e=n.next();!e.done;)e.value(),e=n.next()})),h=function(){o.width=window.innerWidth*window.devicePixelRatio,o.height=window.innerHeight*window.devicePixelRatio,a[0]=o.width,a[1]=o.height,c.resize.apply(c,a)};n.canvas||(window.addEventListener("resize",h),window.addEventListener("orientationchange",h),h());var m=function(){v.cancel(),o=void 0,e=void 0,window.removeEventListener("resize",h),window.removeEventListener("orientationchange",h)};return{get canvas(){return o},get regl(){return e},get gamma(){return i},set gamma(n){i=+n},render:s,onFrame:p,refresh:d,destroy:m}},ge=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===n?e:n},we=document.createElement("style");document.head.appendChild(we);var xe=we.sheet,be=function(n){var e=xe.rules.length;return xe.insertRule(n,e),e},Se=function(n){xe.deleteRule(n)},Me="".concat(2500,"ms ease scaleInFadeOut 0s 1 normal backwards"),Ae=function(n,e,t){return"\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ".concat(n,";\n    transform: translate(-50%,-50%) scale(").concat(e,") rotate(").concat(t,"deg);\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1) rotate(").concat(t+20,"deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9) rotate(").concat(t+60,"deg);\n  }\n}\n")},Ee=null,Ce="".concat(250,"ms ease fadeScaleOut 0s 1 normal backwards"),Ie=function(n,e,t){return"\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ".concat(n,";\n    transform: translate(-50%,-50%) scale(").concat(e,") rotate(").concat(t,"deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0) rotate(").concat(t,"deg);\n  }\n}\n")},Pe=null,Re=function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.onDraw,r=void 0===o?V:o,i=t.onStart,a=void 0===i?V:i,c=t.onEnd,l=void 0===c?V:c,u=t.enableInitiator,d=void 0===u||u,f=t.initiatorParentElement,p=void 0===f?document.body:f;t.minDelay,t.minDist;var v=t.pointNorm,h=void 0===v?V:v,m=d,y=p,g=r,w=a,x=l,b=h,S=document.createElement("div"),M=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);S.id="lasso-initiator-".concat(M),S.style.position="fixed",S.style.display="flex",S.style.justifyContent="center",S.style.alignItems="center",S.style.zIndex=99,S.style.width="4rem",S.style.height="4rem",S.style.borderRadius="4rem",S.style.opacity=.5,S.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)";var A,E=!1,C=!1,I=[],P=[],R=function(){E=!1},T=function(n){var t=e.getBoundingClientRect(),o=t.left,r=t.top;return[n.clientX-o,n.clientY-r]};window.addEventListener("mouseup",R);var O=function(){S.style.opacity=.5,S.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)"},B=function(){var n=getComputedStyle(S),e=+n.opacity,t=n.transform.match(/([0-9.-]+)+/g),o=+t[0],r=+t[1];return{opacity:e,scale:Math.sqrt(o*o+r*r),rotate:Math.atan2(r,o)*(180/Math.PI)}},D=function(n){m&&J(0).then((function(){var e=n.clientX,t=n.clientY;if(!E){var o,r,i,a=B();o=a.opacity,r=a.scale,i=a.rotate,S.style.opacity=o,S.style.transform="translate(-50%,-50%) scale(".concat(r,") rotate(").concat(i,"deg)"),S.style.animation="none",X(2).then((function(){S.style.top="".concat(t,"px"),S.style.left="".concat(e,"px"),null!==Ee&&Se(Ee),Ee=be(Ae(o,r,i)),S.style.animation=Me,X().then((function(){O()}))}))}}))},z=function(){var n=B(),e=n.opacity,t=n.scale,o=n.rotate;S.style.opacity=e,S.style.transform="translate(-50%,-50%) scale(".concat(t,") rotate(").concat(o,"deg)"),S.style.animation="none",X(2).then((function(){null!==Pe&&Se(Pe),Pe=be(Ie(e,t,o)),S.style.animation=Ce,X().then((function(){O()}))}))},L=function(){g(I,P)},j=function(n){if(A){if(U(n[0],n[1],A[0],A[1])>2){A=n;var e=b(n);I.push(e),P.push(e[0],e[1]),I.length>1&&L()}}else{C||(C=!0,w()),A=n;var t=b(n);I=[t],P=[t[0],t[1]]}},k=$(j,8,8),F=function(n,e){var t=T(n);return e?k(t):j(t)},_=function(){I=[],P=[],A=void 0,L()},N=function(n){D(n)},W=function(){E=!0,C=!0,_(),w()},Z=function(){z()},Y=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.merge,t=void 0!==e&&e;C=!1;var o=s(I),r=s(P);return k.cancel(),_(),o.length&&x(o,r,{merge:t}),o},Q=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.onDraw,t=void 0===e?null:e,o=n.onStart,r=void 0===o?null:o,i=n.onEnd,a=void 0===i?null:i,c=n.enableInitiator,l=void 0===c?null:c,u=n.initiatorParentElement,s=void 0===u?null:u;n.minDelay,n.minDist;var d=n.pointNorm,f=void 0===d?null:d;g=ge(t,g),w=ge(r,w),x=ge(a,x),m=ge(l,m),b=ge(f,b),null!==s&&s!==y&&(y.removeChild(S),s.appendChild(S),y=s),m?(S.addEventListener("click",N),S.addEventListener("mousedown",W),S.addEventListener("mouseleave",Z)):(S.removeEventListener("mousedown",W),S.removeEventListener("mouseleave",Z))},nn=function(){y.removeChild(S),window.removeEventListener("mouseup",R),S.removeEventListener("click",N),S.removeEventListener("mousedown",W),S.removeEventListener("mouseleave",Z)},en=function(){return function(n){return q(n,{clear:_,destroy:nn,end:Y,extend:F,set:Q,showInitiator:D,hideInitiator:z})}};return y.appendChild(S),Q({onDraw:g,onStart:w,onEnd:x,enableInitiator:m,initiatorParentElement:y}),G(K("initiator",S),en(),H(n))({})};const Te="\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",Oe="\nprecision mediump float;\n\nuniform mat4 modelViewProjection;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = modelViewProjection * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",Be="\nprecision highp float;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nfloat linearstep(float edge0, float edge1, float x) {\n  return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\nvoid main() {\n  vec2 c = gl_PointCoord * 2.0 - 1.0;\n  float sdf = length(c) * finalPointSize;\n  float alpha = linearstep(finalPointSize + 0.5, finalPointSize - 0.5, sdf);\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",De="precision highp float;\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n",ze=n=>`\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float stateTexEps;\nuniform float devicePixelRatio;\nuniform sampler2D encodingTex;\nuniform float encodingTexRes;\nuniform float encodingTexEps;\nuniform float pointSizeExtra;\nuniform float pointOpacityMax;\nuniform float pointOpacityScale;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByZ;\nuniform float isColoredByW;\nuniform float isOpacityByZ;\nuniform float isOpacityByW;\nuniform float isOpacityByDensity;\nuniform float isSizedByZ;\nuniform float isSizedByW;\nuniform float colorMultiplicator;\nuniform float opacityMultiplicator;\nuniform float opacityDensity;\nuniform float sizeMultiplicator;\nuniform float numColorStates;\nuniform float pointScale;\nuniform mat4 modelViewProjection;\n\nattribute vec2 stateIndex;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nvoid main() {\n  vec4 state = texture2D(stateTex, stateIndex);\n\n  gl_Position = modelViewProjection * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexZ =  isColoredByZ * floor(state.z * colorMultiplicator);\n  float colorIndexW =  isColoredByW * floor(state.w * colorMultiplicator);\n\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  float colorIndex = (colorIndexZ + colorIndexW) * numColorStates;\n\n  // Half a "pixel" or "texel" in texture coordinates\n  float colorLinearIndex = colorIndex + globalState;\n\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + colorTexEps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // Retrieve point size\n  float pointSizeIndexZ = isSizedByZ * floor(state.z * sizeMultiplicator);\n  float pointSizeIndexW = isSizedByW * floor(state.w * sizeMultiplicator);\n  float pointSizeIndex = pointSizeIndexZ + pointSizeIndexW;\n\n  float pointSizeRowIndex = floor((pointSizeIndex + encodingTexEps) / encodingTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / encodingTexRes) - pointSizeRowIndex + encodingTexEps,\n    pointSizeRowIndex / encodingTexRes + encodingTexEps\n  );\n  float pointSize = texture2D(encodingTex, pointSizeTexIndex).x;\n\n  // Retrieve opacity\n  ${3===n?"":`\n        if (isOpacityByDensity < 0.5) {\n          float opacityIndexZ = isOpacityByZ * floor(state.z * opacityMultiplicator);\n          float opacityIndexW = isOpacityByW * floor(state.w * opacityMultiplicator);\n          float opacityIndex = opacityIndexZ + opacityIndexW;\n\n          float opacityRowIndex = floor((opacityIndex + encodingTexEps) / encodingTexRes);\n          vec2 opacityTexIndex = vec2(\n            (opacityIndex / encodingTexRes) - opacityRowIndex + encodingTexEps,\n            opacityRowIndex / encodingTexRes + encodingTexEps\n          );\n          color.a = texture2D(encodingTex, opacityTexIndex)[${1+n}];\n        } else {\n          color.a = min(1.0, opacityDensity + globalState);\n        }\n      `}\n\n  color.a = min(pointOpacityMax, color.a) * pointOpacityScale;\n  finalPointSize = (pointSize * pointScale) + pointSizeExtra;\n  gl_PointSize = finalPointSize;\n}\n`,Le="precision highp float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",je="precision highp float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}";var ke=function(){var n=function(n,e,t,o,r){var i=.5*(o-e),a=.5*(r-t);return(2*t-2*o+i+a)*n*n*n+(-3*t+3*o-2*i-a)*n*n+i*n+t},e=function(e,t,o){var r=o*e,i=Math.floor(r),a=r-i,c=t[Math.max(0,i-1)],l=t[i],u=t[Math.min(o,i+1)],s=t[Math.min(o,i+2)];return[n(a,c[0],l[0],u[0],s[0]),n(a,c[1],l[1],u[1],s[1])]},t=function(n,e,t,o){return Math.pow(n-t,2)+Math.pow(e-o,2)},o=function(n,e,t){var o=e[0],r=e[1],i=t[0]-o,a=t[1]-r;if(0!==i||0!==a){var c=((n[0]-o)*i+(n[1]-r)*a)/(i*i+a*a);c>1?(o=t[0],r=t[1]):c>0&&(o+=i*c,r+=a*c)}return(i=n[0]-o)*i+(a=n[1]-r)*a},r=function n(e,t,r,i,a){for(var c,l=i,u=t+1;u<r;u++){var s=o(e[u],e[t],e[r]);s>l&&(c=u,l=s)}l>i&&(c-t>1&&n(e,t,c,i,a),a.push(e[c]),r-c>1&&n(e,c,r,i,a))},i=function(n,e){var t=n.length-1,o=[n[0]];return r(n,0,t,e,o),o.push(n[t]),o};self.onmessage=function(n){(n.data.points?+n.data.points.length:0)||self.postMessage({error:new Error("No points provided")}),n.data.points;var o=function(n){var e={},t=!Number.isNaN(+n[0][5]);return n.forEach((function(n){var o=n[4];e[o]||(e[o]=[]),t?e[o][n[5]]=n:e[o].push(n)})),Object.entries(e).forEach((function(n){e[n[0]]=n[1].filter((function(n){return n})),e[n[0]].reference=n[1][0]})),e}(n.data.points);self.postMessage({points:Object.entries(o).reduce((function(o,r){return o[r[0]]=function(n){for(var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.maxIntPointsPerSegment,c=void 0===a?100:a,l=r.tolerance,u=void 0===l?.002:l,s=n.length,d=s-1,f=d*c+1,p=Math.pow(u,2),v=[],h=0;h<s-1;h++){var m=[n[h].slice(0,2)];o=n[h];for(var y=1;y<c;y++){var g=e((h*c+y)/f,n,d);t(o[0],o[1],g[0],g[1])>p&&(m.push(g),o=g)}m.push(n[h+1]),m=i(m,p),v=v.concat(m.slice(0,m.length-1))}return v.push(n[n.length-1].slice(0,2)),v.flat()}(r[1],n.data.options),o[r[0]].reference=r[1].reference,o}),{})})}},Fe=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tolerance:.002,maxIntPointsPerSegment:100};return new Promise((function(t,o){var r=Y(ke);r.onmessage=function(n){n.data.error?o(n.data.error):t(n.data.points),r.terminate()},r.postMessage({points:n,options:e})}))},_e="1.3.0",Ne={showRecticle:"showReticle",recticleColor:"reticleColor"},Ve=function(n){Object.keys(n).filter((function(n){return Ne[n]})).forEach((function(e){console.warn('regl-scatterplot: the "'.concat(e,'" property is deprecated. Please use "').concat(Ne[e],'" instead.')),n[Ne[e]]=n[e],delete n[e]}))},We=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.allowSegment,r=void 0!==o&&o,i=t.allowDensity,a=void 0!==i&&i;return Kn.has(n)?"valueZ":Un.has(n)?"valueW":"segment"===n?r?"segment":e:"density"===n&&a?"density":e},Ze=function(n){switch(n){case"valueZ":return 2;case"valueW":return 3;default:return null}};n.createRegl=Xn,n.createRenderer=ye,n.createTextureFromUrl=re,n.default=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r.default({async:!n.syncEvents,caseInsensitive:!0}),t=new Float32Array(16),o=new Float32Array(16),i=[0,0];Ve(n);var a=n.renderer,l=n.backgroundColor,d=void 0===l?Fn:l,f=n.backgroundImage,p=void 0===f?null:f,v=n.canvas,h=void 0===v?document.createElement("canvas"):v,w=n.colorBy,S=void 0===w?zn:w,M=n.deselectOnDblClick,A=void 0===M||M,C=n.deselectOnEscape,I=void 0===C||C,P=n.lassoColor,R=void 0===P?hn:P,T=n.lassoLineWidth,O=void 0===T?2:T,B=n.lassoMinDelay,z=void 0===B?10:B,L=n.lassoMinDist,j=void 0===L?3:L,k=n.lassoClearEvent,F=void 0===k?mn:k,N=n.lassoInitiator,q=void 0!==N&&N,G=n.lassoInitiatorParentElement,H=void 0===G?document.body:G,K=n.keyMap,U=void 0===K?In:K,Y=n.mouseMode,X=void 0===Y?un:Y,J=n.showReticle,Q=void 0!==J&&J,tn=n.reticleColor,on=void 0===tn?Gn:tn,gn=n.pointColor,Yn=void 0===gn?Ln:gn,Xn=n.pointColorActive,Qn=void 0===Xn?jn:Xn,ie=n.pointColorHover,ae=void 0===ie?kn:ie,ue=n.showPointConnections,se=void 0!==ue&&ue,ge=n.pointConnectionColor,we=void 0===ge?Nn:ge,xe=n.pointConnectionColorActive,be=void 0===xe?Vn:xe,Se=n.pointConnectionColorHover,Me=void 0===Se?Wn:Se,Ae=n.pointConnectionColorBy,Ee=void 0===Ae?_n:Ae,Ce=n.pointConnectionOpacity,Ie=void 0===Ce?null:Ce,Pe=n.pointConnectionOpacityBy,ke=void 0===Pe?Bn:Pe,Ne=n.pointConnectionOpacityActive,qe=void 0===Ne?.66:Ne,Ge=n.pointConnectionSize,He=void 0===Ge?2:Ge,Ke=n.pointConnectionSizeActive,Ue=void 0===Ke?2:Ke,Ye=n.pointConnectionSizeBy,Xe=void 0===Ye?On:Ye,$e=n.pointConnectionMaxIntPointsPerSegment,Je=void 0===$e?100:$e,Qe=n.pointConnectionTolerance,nt=void 0===Qe?.002:Qe,et=n.pointSize,tt=void 0===et?6:et,ot=n.pointSizeSelected,rt=void 0===ot?2:ot,it=n.pointSizeMouseDetection,at=void 0===it?Hn:it,ct=n.pointOutlineWidth,lt=void 0===ct?2:ct,ut=n.opacity,st=void 0===ut?nn:ut,dt=n.opacityBy,ft=void 0===dt?Dn:dt,pt=n.opacityByDensityFill,vt=void 0===pt?.15:pt,ht=n.opacityInactiveMax,mt=void 0===ht?1:ht,yt=n.opacityInactiveScale,gt=void 0===yt?1:yt,wt=n.sizeBy,xt=void 0===wt?Tn:wt,bt=n.height,St=void 0===bt?Rn:bt,Mt=n.width,At=void 0===Mt?Pn:Mt,Et=At===nn?1:At,Ct=St===nn?1:St,It=n.performanceMode,Pt=void 0!==It&&It,Rt=n.opacityByDensityDebounceTime,Tt=void 0===Rt?25:Rt;a||(a=ye({regl:n.regl,gamma:n.gamma})),d=ve(d,!0),R=ve(R,!0),on=ve(on,!0);var Ot,Bt,Dt,zt,Lt,jt,kt,Ft,_t,Nt,Vt,Wt,Zt,qt,Gt,Ht,Kt,Ut=me(d),Yt=!1,Xt=[],$t=new Set,Jt=new Set,Qt=null,no=[0,0],eo=0,to=0,oo=!1,ro=[],io=1,ao=he(U),co=!1,lo=!0,uo=!1;Yn=de(Yn)?s(Yn):[Yn],Qn=de(Qn)?s(Qn):[Qn],ae=de(ae)?s(ae):[ae],Yn=Yn.map((function(n){return ve(n,!0)})),Qn=Qn.map((function(n){return ve(n,!0)})),ae=ae.map((function(n){return ve(n,!0)})),st=!Array.isArray(st)&&Number.isNaN(+st)?Yn[0][3]:st,st=ne(st,ee,{minLength:1})?s(st):[st];var so,fo,po,vo,ho=1/(tt=ne(tt,ee,{minLength:1})?s(tt):[tt])[0];we="inherit"===we?s(Yn):(we=de(we)?s(we):[we]).map((function(n){return ve(n,!0)})),be="inherit"===be?s(Qn):(be=de(be)?s(be):[be]).map((function(n){return ve(n,!0)})),Me="inherit"===Me?s(ae):(Me=de(Me)?s(Me):[Me]).map((function(n){return ve(n,!0)})),Ie="inherit"===Ie?s(st):ne(Ie,ee,{minLength:1})?s(Ie):[Ie],He="inherit"===He?s(tt):ne(He,ee,{minLength:1})?s(He):[He],S=We(S,zn),ft=We(ft,Dn,{allowDensity:!0}),xt=We(xt,Tn),Ee=We(Ee,_n,{allowSegment:!0}),ke=We(ke,Bn,{allowSegment:!0}),Xe=We(Xe,On,{allowSegment:!0});var mo,yo,go,wo,xo,bo,So,Mo,Ao=0,Eo=0,Co=!1,Io=null,Po=Q,Ro=0,To=0,Oo=!1,Bo=!1,Do=0,zo=0,Lo=!1,jo=n.xScale||null,ko=n.yScale||null,Fo=0,_o=0,No=0,Vo=0;jo&&(Fo=jo.domain()[0],_o=jo.domain()[1]-jo.domain()[0],jo.range([0,Et])),ko&&(No=ko.domain()[0],Vo=ko.domain()[1]-ko.domain()[0],ko.range([Ct,0]));var Wo=function(n){return n/Et*2-1},Zo=function(n){return 1+n/Ct*-2},qo=function(){return[Wo(i[0]),Zo(i[1])]},Go=function(n,e){var o=[n,e,1,1];return b(o,o,y(t,g(t,Lt,g(t,Ot.view,kt)))),o.slice(0,2)},Ho=function(){var n,e=u(qo(),2),t=e[0],o=e[1],r=u(Go(t,o),2),i=r[0],a=r[1],c=ci(),l=Gt[1]-Ht[1],s=Zt*c*(l/Ct)*.66,d=Dt.range(i-s,a-s,i+s,a+s),f=s;return d.forEach((function(e){var t=u(Dt.points[e],2),o=t[0],r=t[1],c=$n(o,r,i,a);c<f&&(f=c,n=e)})),f<Zt/Et*2?n:-1},Ko=function(n,t){ro=n,Bt.setPoints(t),e.publish("lassoExtend",{coordinates:n})},Uo=function(n){var e,t=Jn(n),o=(e=Dt).range.apply(e,s(t)),r=[];return o.forEach((function(e){ce(n,Dt.points[e])&&r.push(e)})),r},Yo=function(){ro=[],Bt&&Bt.clear()},Xo=function(n){return n&&n.length>4},$o=function(n,e){if(!Nt&&se&&Xo(Dt.points[n[0]])){var t=0===e,o=1===e?function(n){return Jt.add(n)}:V,r=Object.keys(n.reduce((function(n,e){var t=Dt.points[e];return n[Array.isArray(t[4])?t[4][0]:t[4]]=!0,n}),{})),i=Ft.getData().opacities;r.filter((function(n){return!Jt.has(+n)})).forEach((function(n){var e=_t[n][0],r=_t[n][2],a=4*e+2*_t[n][3],c=a+2*r+4;void 0===i.__original__&&(i.__original__=i.slice());for(var l=a;l<c;l++)i[l]=t?i.__original__[l]:qe;o(n)})),Ft.getBuffer().opacities.subdata(i,0)}},Jo=function(n){return[n%Ao/Ao+Eo,Math.floor(n/Ao)/Ao+Eo]},Qo=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.preventEvent,o=void 0!==t&&t;F===fn&&Yo(),Xt.length&&(o||e.publish("deselect"),Jt.clear(),$o(Xt,0),Xt=[],$t.clear(),lo=!0)},nr=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.merge,r=void 0!==o&&o,i=t.preventEvent,a=void 0!==i&&i,c=Array.isArray(n)?n:[n];r?Xt=Z(Xt,c):(Xt&&Xt.length&&$o(Xt,0),Xt=c);var l=[];$t.clear(),Jt.clear();for(var u=Xt.length-1;u>=0;u--){var s=Xt[u];if(s<0||s>=eo)Xt.splice(u,1);else{$t.add(s);var d=Jo(s);l.push(d[0]),l.push(d[1])}}yo({usage:"dynamic",type:"float",data:l}),$o(Xt,1),a||e.publish("select",{points:Xt}),lo=!0},er=function(n){var e=h.getBoundingClientRect();return i[0]=n.clientX-e.left,i[1]=n.clientY-e.top,[].concat(i)},tr=function(){Ot.config({isFixed:!0}),Yt=!0,oo=!0,Yo(),e.publish("lassoStart")},or=function(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=o.merge,i=void 0!==r&&r;Ot.config({isFixed:!1}),ro=s(n);var a=Uo(t);nr(a,{merge:i}),e.publish("lassoEnd",{coordinates:ro}),F===pn&&Yo()},rr=Re(h,{onStart:tr,onDraw:Ko,onEnd:or,enableInitiator:q,initiatorParentElement:H,pointNorm:function(n){var e=u(n,2),t=e[0],o=e[1];return Go(Wo(t),Zo(o))}}),ir=function(){return X===an},ar=function(n,e){switch(ao[e]){case bn:return n.altKey;case Sn:return n.metaKey;case Mn:return n.ctrlKey;case An:return n.metaKey;case En:return n.shiftKey;default:return!1}},cr=function(n){Bo&&(Yt=!0,Qt=performance.now(),no=er(n),oo=ir()||ar(n,yn))},lr=function(n){Bo&&(Yt=!1,oo&&(n.preventDefault(),oo=!1,rr.end({merge:ar(n,wn)})))},ur=function(n){if(Bo){n.preventDefault();var e=er(n);if(!($n.apply(void 0,s(e).concat(s(no)))>=j)){var t=performance.now()-Qt;if(q&&t>500)rr.showInitiator(n);else{var o=Ho();o>=0?(Xt.length&&F===fn&&Yo(),nr([o],{merge:ar(n,wn)})):(Qo(),qt||(qt=setTimeout((function(){qt=null,rr.showInitiator(n)}),200)))}}}},sr=function(n){rr.hideInitiator(),qt&&(clearTimeout(qt),qt=null),A&&(n.preventDefault(),Qo())},dr=function(n){Bo&&(Lo||Yt)&&(er(n),Lo&&!oo&&Va(Ho()),oo&&(n.preventDefault(),rr.extend(n,!0)),Yt&&(lo=!0))},fr=function(){Bo&&(+Mo>=0&&!$t.has(Mo)&&$o([Mo],0),Mo=void 0,Lo=!1,lr(),lo=!0)},pr=function(){var n=Math.max(tt.length,st.length);To=Math.max(2,Math.ceil(Math.sqrt(n)));for(var e=new Float32Array(4*Math.pow(To,2)),t=0;t<n;t++){e[4*t]=tt[t]||0,e[4*t+1]=Math.min(1,st[t]||0);var o=Number((Qn[t]||Qn[0])[3]);e[4*t+2]=Math.min(1,Number.isNaN(o)?1:o);var r=Number((ae[t]||ae[0])[3]);e[4*t+3]=Math.min(1,Number.isNaN(r)?1:r)}return a.regl.texture({data:e,shape:[To,To,4],type:"float"})},vr=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yn,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qn,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ae,o=n.length,r=e.length,i=t.length,a=[];if(o===r&&r===i)for(var c=0;c<o;c++)a.push(n[c],e[c],t[c],d);else for(var l=0;l<o;l++){var u=[n[l][0],n[l][1],n[l][2],1],s=S===zn?e[0]:u,f=S===zn?t[0]:u;a.push(n[l],s,f,d)}return a},hr=function(){var n=vr(),e=n.length;Ro=Math.max(2,Math.ceil(Math.sqrt(e)));var t=new Float32Array(4*Math.pow(Ro,2));return n.forEach((function(n,e){t[4*e]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]})),a.regl.texture({data:t,shape:[Ro,Ro,4],type:"float"})},mr=function(n,e){jt[0]=n/zt,jt[5]=e},yr=function(){Lt=x([],[1/(zt=Et/Ct),1,1]),jt=x([],[1/zt,1,1]),kt=x([],[io,1,1])},gr=function(n){+n<=0||(io=n)},wr=function(n,e){return function(t){if(t&&t.length){var o=s(n()),r=de(t)?t:[t];r=r.map((function(n){return ve(n,!0)})),bo&&bo.destroy();try{e(r),bo=hr()}catch(n){console.error("Invalid colors. Switching back to default colors."),e(o),bo=hr()}}}},xr=wr((function(){return Yn}),(function(n){Yn=n})),br=wr((function(){return Qn}),(function(n){Qn=n})),Sr=wr((function(){return ae}),(function(n){ae=n})),Mr=function(){var n=Go(-1,-1),e=Go(1,1),t=(n[0]+1)/2,o=(e[0]+1)/2,r=(n[1]+1)/2,i=(e[1]+1)/2;return[[Fo+t*_o,Fo+o*_o],[No+r*Vo,No+i*Vo]]},Ar=function(){if(jo||ko){var n=u(Mr(),2),e=n[0],t=n[1];jo&&jo.domain(e),ko&&ko.domain(t)}},Er=function(n){Ct=n,h.height=Math.floor(Ct*window.devicePixelRatio),ko&&(ko.range([Ct,0]),Ar())},Cr=function(n){if(n===nn)return St=n,h.style.height="100%",void window.requestAnimationFrame((function(){h&&Er(h.getBoundingClientRect().height)}));!+n||+n<=0||(Er(St=+n),h.style.height="".concat(St,"px"))},Ir=function(){Zt=at,at===nn&&(Zt=Array.isArray(tt)?tt[Math.floor(tt.length/2)]:tt)},Pr=function(n){ne(n,ee,{minLength:1})&&(tt=s(n)),te(+n)&&(tt=[+n]),ho=1/tt[0],So=pr(),Ir()},Rr=function(n){!+n||+n<0||(rt=+n)},Tr=function(n){!+n||+n<0||(lt=+n)},Or=function(n){Et=n,h.width=Math.floor(Et*window.devicePixelRatio),jo&&(jo.range([0,Et]),Ar())},Br=function(n){if(n===nn)return At=n,h.style.width="100%",void window.requestAnimationFrame((function(){h&&Or(h.getBoundingClientRect().width)}));!+n||+n<=0||(Or(At=+n),h.style.width="".concat(Et,"px"))},Dr=function(n){ne(n,ee,{minLength:1})&&(st=s(n)),te(+n)&&(st=[+n]),So=pr()},zr=function(n){switch(n){case"valueZ":return Do>1?"categorical":"continuous";case"valueW":return zo>1?"categorical":"continuous";default:return null}},Lr=function(n,e){switch(n){case"continuous":return function(n){return Math.round(n*(e.length-1))};case"categorical":default:return V}},jr=function(n){S=We(n,zn)},kr=function(n){ft=We(n,Dn,{allowDensity:!0})},Fr=function(n){xt=We(n,Tn)},_r=function(n){Ee=We(n,_n,{allowSegment:!0})},Nr=function(n){ke=We(n,Bn,{allowSegment:!0})},Vr=function(n){Xe=We(n,On,{allowSegment:!0})},Wr=function(){return[h.width,h.height]},Zr=function(){return p},qr=function(){return bo},Gr=function(){return Ro},Hr=function(){return.5/Ro},Kr=function(){return window.devicePixelRatio},Ur=function(){return mo},Yr=function(){return yo},Xr=function(){return So},$r=function(){return To},Jr=function(){return.5/To},Qr=function(){return 0},ni=function(){return po||so},ei=function(){return Ao},ti=function(){return.5/Ao},oi=function(){return jt},ri=function(){return Ot.view},ii=function(){return kt},ai=function(){return g(o,jt,g(o,Ot.view,kt))},ci=function(){return Ot.scaling[0]>1?Math.asinh(fe(1,Ot.scaling[0]))/Math.asinh(1)*window.devicePixelRatio:fe(ho,Ot.scaling[0])*window.devicePixelRatio},li=function(){return eo},ui=function(){return Xt.length},si=function(){return ui()>0?mt:1},di=function(){return ui()>0?gt:1},fi=function(){return+("valueZ"===S)},pi=function(){return+("valueW"===S)},vi=function(){return+("valueZ"===ft)},hi=function(){return+("valueW"===ft)},mi=function(){return+("density"===ft)},yi=function(){return+("valueZ"===xt)},gi=function(){return+("valueW"===xt)},wi=function(){return"valueZ"===S?Do<=1?Yn.length-1:1:zo<=1?Yn.length-1:1},xi=function(){return"valueZ"===ft?Do<=1?st.length-1:1:zo<=1?st.length-1:1},bi=function(){return"valueZ"===xt?Do<=1?tt.length-1:1:zo<=1?tt.length-1:1},Si=function(n){if("density"!==ft)return 1;var e=ci(),t=tt[0]*e,o=2/(2/Ot.view[0])*(2/(2/Ot.view[5])),r=n.viewportHeight,i=n.viewportWidth,a=vt*i*r/(to*t*t)*pe(1,o);a*=Pt?1:1/(.25*Math.PI);var c=fe(1,t)+.5;return a*=Math.pow(t/c,2),pe(1,fe(0,a))},Mi=a.regl({framebuffer:function(){return vo},vert:je,frag:Le,attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:function(){return fo},endStateTex:function(){return so},t:function(n,e){return e.t}},count:3}),Ai=function(n,e,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:si,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:di;return a.regl({frag:Pt?De:Be,vert:ze(o),blend:{enable:!Pt,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:t,size:2}},uniforms:{resolution:Wr,modelViewProjection:ai,devicePixelRatio:Kr,pointScale:ci,encodingTex:Xr,encodingTexRes:$r,encodingTexEps:Jr,pointOpacityMax:r,pointOpacityScale:i,pointSizeExtra:n,globalState:o,colorTex:qr,colorTexRes:Gr,colorTexEps:Hr,stateTex:ni,stateTexRes:ei,stateTexEps:ti,isColoredByZ:fi,isColoredByW:pi,isOpacityByZ:vi,isOpacityByW:hi,isOpacityByDensity:mi,isSizedByZ:yi,isSizedByW:gi,colorMultiplicator:wi,opacityMultiplicator:xi,opacityDensity:Si,sizeMultiplicator:bi,numColorStates:4},count:e,primitive:"points"})},Ei=Ai(Qr,li,Ur),Ci=Ai(Qr,(function(){return 1}),(function(){return go}),2,(function(){return 1}),(function(){return 1})),Ii=Ai((function(){return(rt+2*lt)*window.devicePixelRatio}),ui,Yr,1,(function(){return 1}),(function(){return 1})),Pi=Ai((function(){return(rt+lt)*window.devicePixelRatio}),ui,Yr,3,(function(){return 1}),(function(){return 1})),Ri=Ai((function(){return rt*window.devicePixelRatio}),ui,Yr,1,(function(){return 1}),(function(){return 1})),Ti=function(){Ii(),Pi(),Ri()},Oi=a.regl({frag:Te,vert:Oe,attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{modelViewProjection:ai,texture:Zr},count:6}),Bi=a.regl({vert:"\n      precision mediump float;\n      uniform mat4 modelViewProjection;\n      attribute vec2 position;\n      void main () {\n        gl_Position = modelViewProjection * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:function(){return ro}},uniforms:{modelViewProjection:ai,color:function(){return R}},elements:function(){return Array.from({length:ro.length-2},(function(n,e){return[0,e+1,e+2]}))}}),Di=function(){if(Mo>=0){var n=u(Dt.points[Mo].slice(0,2),2),e=[n[0],n[1],0,1];g(t,jt,g(t,Ot.view,kt)),b(e,e,t),Vt.setPoints([-1,e[1],1,e[1]]),Wt.setPoints([e[0],1,e[0],-1]),Vt.draw(),Wt.draw(),Ai((function(){return(rt+2*lt)*window.devicePixelRatio}),(function(){return 1}),go,1)(),Ai((function(){return(rt+lt)*window.devicePixelRatio}),(function(){return 1}),go,3)()}},zi=function(n){for(var e=new Float32Array(2*n),t=0,o=0;o<n;++o){var r=Jo(o);e[t]=r[0],e[t+1]=r[1],t+=2}return e},Li=function(n){var e=n.length;Ao=Math.max(2,Math.ceil(Math.sqrt(e))),Eo=.5/Ao;var t=new Float32Array(4*Math.pow(Ao,2));Do=0,zo=0;for(var o=0;o<e;++o)t[4*o]=n[o][0],t[4*o+1]=n[o][1],t[4*o+2]=n[o][2]||0,t[4*o+3]=n[o][3]||0,Do=Math.max(Do,t[4*o+2]),zo=Math.max(zo,t[4*o+3]);return a.regl.texture({data:t,shape:[Ao,Ao,4],type:"float"})},ji=function(n){if(!so)return!1;if(Co){var e=fo;fo=po,e.destroy()}else fo=so;return po=Li(n),vo=a.regl.framebuffer({color:po,depth:!1,stencil:!1}),so=void 0,!0},ki=function(){fo&&(fo.destroy(),fo=void 0),po&&(po.destroy(),po=void 0)},Fi=function(n){Bo=!1,eo=n.length,to=eo,so&&so.destroy(),so=Li(n),mo({usage:"static",type:"float",data:zi(eo)}),Dt=new D(n,(function(n){return n[0]}),(function(n){return n[1]}),16),Bo=!0},_i=function(n){var e="inherit"===Ee?S:Ee;if("segment"===e){var t=we.length-1;return t<1?[]:n.reduce((function(n,e,o){for(var r=0,i=[],a=2;a<e.length;a+=2){var c=Math.sqrt(Math.pow(e[a-2]-e[a],2)+Math.pow(e[a-1]-e[a+1],2));i.push(c),r+=c}n[o]=[0];for(var l=0,u=0;u<e.length/2-1;u++)l+=i[u],n[o].push(4*Math.floor(l/r*t));return n}),[])}if(e){var o=Ze(e),r=Lr(zr(e),"inherit"===Ee?Yn:we);return _t.reduce((function(n,e){var t=u(e,2),i=t[0],a=t[1];return n[i]=4*r(a[o]),n}),[])}return Array(_t.length).fill(0)},Ni=function(){var n="inherit"===ke?ft:ke;if("segment"===n){var e=Ie.length-1;return e<1?[]:_t.reduce((function(n,t){var o=u(t,3),r=o[0];o[1];var i=o[2];return n[r]=W(i,(function(n){return Ie[Math.floor(n/(i-1)*e)]})),n}),[])}if(n){var t=Ze(n),o="inherit"===ke?st:Ie,r=Lr(zr(n),o);return _t.reduce((function(n,e){var i=u(e,2),a=i[0],c=i[1];return n[a]=o[r(c[t])],n}),[])}},Vi=function(){var n="inherit"===Xe?xt:Xe;if("segment"===n){var e=He.length-1;return e<1?[]:_t.reduce((function(n,t){var o=u(t,3),r=o[0];o[1];var i=o[2];return n[r]=W(i,(function(n){return He[Math.floor(n/(i-1)*e)]})),n}),[])}if(n){var t=Ze(n),o="inherit"===Xe?tt:He,r=Lr(zr(n),o);return _t.reduce((function(n,e){var i=u(e,2),a=i[0],c=i[1];return n[a]=o[r(c[t])],n}),[])}},Wi=function(n){_t=[];var e=0;Object.keys(n).forEach((function(t,o){_t[t]=[o,n[t].reference,n[t].length/2,e],e+=n[t].length/2}))},Zi=function(n){return new Promise((function(e){Ft.setPoints([]),n&&n.length?(Nt=!0,Fe(n,{maxIntPointsPerSegment:Je,tolerance:nt}).then((function(n){Wi(n);var t=Object.values(n);Ft.setPoints(t,{colorIndices:_i(t),opacities:Ni(),widths:Vi()}),Nt=!1,e()}))):e()}))},qi=function(){return Dt.range(Ht[0],Ht[1],Gt[0],Gt[1])},Gi=function(){to=qi().length},Hi=$(Gi,Tt),Ki=function(n,e){Io||(Io=performance.now());var t=performance.now()-Io;return Mi({t:Math.min(1,Math.max(0,e(t/n)))}),t<n},Ui=function(){Co=!1,Io=null,wo=void 0,xo=void 0,Q=Po,ki(),e.publish("transitionEnd")},Yi=function(n){var t=n.duration,o=void 0===t?500:t,r=n.easing,i=void 0===r?dn:r;Co&&e.publish("transitionEnd"),Co=!0,Io=null,wo=o,xo=le(i)?sn[i]||dn:i,Po=Q,Q=!1,e.publish("transitionStart")},Xi=function(n){return new Promise((function(e,t){if(!n||Array.isArray(n))e(n);else{var o=Array.isArray(n.x)||ArrayBuffer.isView(n.x)?n.x.length:0,r=(Array.isArray(n.x)||ArrayBuffer.isView(n.x))&&function(e){return n.x[e]},i=(Array.isArray(n.y)||ArrayBuffer.isView(n.y))&&function(e){return n.y[e]},a=(Array.isArray(n.line)||ArrayBuffer.isView(n.line))&&function(e){return n.line[e]},c=(Array.isArray(n.lineOrder)||ArrayBuffer.isView(n.lineOrder))&&function(e){return n.lineOrder[e]},l=Object.keys(n),u=(f=l.find((function(n){return Kn.has(n)})))&&(Array.isArray(n[f])||ArrayBuffer.isView(n[f]))&&function(e){return n[f][e]},s=(d=l.find((function(n){return Un.has(n)})))&&(Array.isArray(n[d])||ArrayBuffer.isView(n[d]))&&function(e){return n[d][e]};r&&i&&u&&s&&a&&c?e(n.x.map((function(n,e){return[n,i(e),u(e),s(e),a(e),c(e)]}))):r&&i&&u&&s&&a?e(Array.from({length:o},(function(n,e){return[r(e),i(e),u(e),s(e),a(e)]}))):r&&i&&u&&s?e(Array.from({length:o},(function(n,e){return[r(e),i(e),u(e),s(e)]}))):r&&i&&u?e(Array.from({length:o},(function(n,e){return[r(e),i(e),u(e)]}))):r&&i?e(Array.from({length:o},(function(n,e){return[r(e),i(e)]}))):t(new Error("You need to specify at least x and y"))}var d,f}))},$i=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Xi(n).then((function(n){return new Promise((function(o){var r=!1;n&&(t.transition&&(n.length===eo?r=ji(n):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),Fi(n),(se||t.showPointConnectionsOnce&&Xo(n[0]))&&Zi(n).then((function(){e.publish("pointConnectionsDraw"),lo=!0,uo=t.showReticleOnce}))),t.transition&&r?(e.subscribe("transitionEnd",(function(){lo=!0,uo=t.showReticleOnce,o()}),1),Yi({duration:t.transitionDuration,easing:t.transitionEasing})):(e.subscribe("draw",o,1),lo=!0,uo=t.showReticleOnce)}))}))},Ji=function(n){return function(){var e=n.apply(void 0,arguments);return lo=!0,e}},Qi=function(){Ft.setStyle({color:vr(we,be,Me),opacity:null===Ie?null:Ie[0],width:He[0]})},na=function(){var n=Math.round(Ut)>0?0:255;rr.initiator.style.border="1px dashed rgba(".concat(n,", ").concat(n,", ").concat(n,", 0.33)"),rr.initiator.style.background="rgba(".concat(n,", ").concat(n,", ").concat(n,", 0.1)")},ea=function(n){n&&(d=ve(n,!0),Ut=me(d),na())},ta=function(n){n?le(n)?re(a.regl,n).then((function(n){p=n,lo=!0,e.publish("backgroundImageReady")})):p="texture2d"===n._reglType?n:null:p=null},oa=function(n){n>0&&Ot.lookAt(Ot.target,n,Ot.rotation)},ra=function(n){null!==n&&Ot.lookAt(Ot.target,Ot.distance[0],n)},ia=function(n){n&&Ot.lookAt(n,Ot.distance[0],Ot.rotation)},aa=function(n){n&&Ot.setView(n)},ca=function(n){n&&(R=ve(n,!0),Bt.setStyle({color:R}))},la=function(n){Number.isNaN(+n)||+n<1||(O=+n,Bt.setStyle({width:O}))},ua=function(n){+n&&(z=+n,rr.set({minDelay:z}))},sa=function(n){+n&&(j=+n,rr.set({minDist:j}))},da=function(n){F=oe(vn,F)(n)},fa=function(n){q=Boolean(n),rr.set({enableInitiator:q})},pa=function(n){H=n,rr.set({startInitiatorParentElement:H})},va=function(n){U=Object.entries(n).reduce((function(n,e){var t=u(e,2),o=t[0],r=t[1];return Cn.includes(o)&&xn.includes(r)&&(n[o]=r),n}),{}),(ao=he(U)).rotate?Ot.config({isRotate:!0,mouseDownMoveModKey:ao.rotate}):Ot.config({isRotate:!1})},ha=function(n){X=oe(ln,rn)(n),Ot.config({defaultMouseDownMoveAction:X===cn?"rotate":"pan"})},ma=function(n){null!==n&&(Q=n)},ya=function(n){n&&(on=ve(n,!0),Vt.setStyle({color:on}),Wt.setStyle({color:on}))},ga=function(n){n&&(jo=n,Fo=n.domain()[0],_o=n?n.domain()[1]-n.domain()[0]:0,jo.range([0,Et]),Ar())},wa=function(n){n&&(No=(ko=n).domain()[0],Vo=ko?ko.domain()[1]-ko.domain()[0]:0,ko.range([Ct,0]),Ar())},xa=function(n){A=!!n},ba=function(n){I=!!n},Sa=function(n){(se=!!n)?Xo(Dt.points[0])&&Zi(Dt.points).then((function(){e.publish("pointConnectionsDraw"),lo=!0})):Zi()},Ma=function(n,e){return function(t){if("inherit"===t)n(s(e()));else{var o=de(t)?t:[t];n(o.map((function(n){return ve(n,!0)})))}Qi()}},Aa=Ma((function(n){we=n}),(function(){return Yn})),Ea=Ma((function(n){be=n}),(function(){return Qn})),Ca=Ma((function(n){Me=n}),(function(){return ae})),Ia=function(n){ne(n,ee,{minLength:1})&&(Ie=s(n)),te(+n)&&(Ie=[+n]),we=we.map((function(n){return n[3]=Number.isNaN(+Ie[0])?n[3]:+Ie[0],n})),Qi()},Pa=function(n){!Number.isNaN(+n)&&+n&&(qe=+n)},Ra=function(n){ne(n,ee,{minLength:1})&&(He=s(n)),te(+n)&&(He=[+n]),Qi()},Ta=function(n){!Number.isNaN(+n)&&+n&&(Ue=Math.max(0,n))},Oa=function(n){Je=Math.max(0,n)},Ba=function(n){nt=Math.max(0,n)},Da=function(n){at=n,Ir()},za=function(n){vt=+n},La=function(n){mt=+n},ja=function(n){gt=+n},ka=function(n){a.gamma=n},Fa=function(n){return Ve({property:!0}),"aspectRatio"===n?io:"background"===n||"backgroundColor"===n?d:"backgroundImage"===n?p:"camera"===n?Ot:"cameraTarget"===n?Ot.target:"cameraDistance"===n?Ot.distance[0]:"cameraRotation"===n?Ot.rotation:"cameraView"===n?Ot.view:"canvas"===n?h:"colorBy"===n?S:"sizeBy"===n?xt:"deselectOnDblClick"===n?A:"deselectOnEscape"===n?I:"height"===n?St:"lassoColor"===n?R:"lassoLineWidth"===n?O:"lassoMinDelay"===n?z:"lassoMinDist"===n?j:"lassoClearEvent"===n?F:"lassoInitiator"===n?q:"lassoInitiatorElement"===n?rr.initiator:"lassoInitiatorParentElement"===n?H:"keyMap"===n?c({},U):"mouseMode"===n?X:"opacity"===n?1===st.length?st[0]:st:"opacityBy"===n?ft:"opacityByDensityFill"===n?vt:"opacityByDensityDebounceTime"===n?Tt:"opacityInactiveMax"===n?mt:"opacityInactiveScale"===n?gt:"points"===n?Dt.points:"pointsInView"===n?qi():"pointColor"===n?1===Yn.length?Yn[0]:Yn:"pointColorActive"===n?1===Qn.length?Qn[0]:Qn:"pointColorHover"===n?1===ae.length?ae[0]:ae:"pointOutlineWidth"===n?lt:"pointSize"===n?1===tt.length?tt[0]:tt:"pointSizeSelected"===n?rt:"pointSizeMouseDetection"===n?at:"showPointConnections"===n?se:"pointConnectionColor"===n?1===we.length?we[0]:we:"pointConnectionColorActive"===n?1===be.length?be[0]:be:"pointConnectionColorHover"===n?1===Me.length?Me[0]:Me:"pointConnectionColorBy"===n?Ee:"pointConnectionOpacity"===n?1===Ie.length?Ie[0]:Ie:"pointConnectionOpacityBy"===n?ke:"pointConnectionOpacityActive"===n?qe:"pointConnectionSize"===n?1===He.length?He[0]:He:"pointConnectionSizeActive"===n?Ue:"pointConnectionSizeBy"===n?Xe:"pointConnectionMaxIntPointsPerSegment"===n?Je:"pointConnectionTolerance"===n?nt:"reticleColor"===n?on:"regl"===n?a.regl:"showReticle"===n?Q:"version"===n?_e:"width"===n?At:"xScale"===n?jo:"yScale"===n?ko:"performanceMode"===n?Pt:"gamma"===n?a.gamma:"renderer"===n?a:void 0},_a=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ve(n),void 0===n.backgroundColor&&void 0===n.background||ea(n.backgroundColor||n.background),void 0!==n.backgroundImage&&ta(n.backgroundImage),void 0!==n.cameraTarget&&ia(n.cameraTarget),void 0!==n.cameraDistance&&oa(n.cameraDistance),void 0!==n.cameraRotation&&ra(n.cameraRotation),void 0!==n.cameraView&&aa(n.cameraView),void 0!==n.colorBy&&jr(n.colorBy),void 0!==n.pointColor&&xr(n.pointColor),void 0!==n.pointColorActive&&br(n.pointColorActive),void 0!==n.pointColorHover&&Sr(n.pointColorHover),void 0!==n.pointSize&&Pr(n.pointSize),void 0!==n.pointSizeSelected&&Rr(n.pointSizeSelected),void 0!==n.pointSizeMouseDetection&&Da(n.pointSizeMouseDetection),void 0!==n.sizeBy&&Fr(n.sizeBy),void 0!==n.opacity&&Dr(n.opacity),void 0!==n.showPointConnections&&Sa(n.showPointConnections),void 0!==n.pointConnectionColor&&Aa(n.pointConnectionColor),void 0!==n.pointConnectionColorActive&&Ea(n.pointConnectionColorActive),void 0!==n.pointConnectionColorHover&&Ca(n.pointConnectionColorHover),void 0!==n.pointConnectionColorBy&&_r(n.pointConnectionColorBy),void 0!==n.pointConnectionOpacityBy&&Nr(n.pointConnectionOpacityBy),void 0!==n.pointConnectionOpacity&&Ia(n.pointConnectionOpacity),void 0!==n.pointConnectionOpacityActive&&Pa(n.pointConnectionOpacityActive),void 0!==n.pointConnectionSize&&Ra(n.pointConnectionSize),void 0!==n.pointConnectionSizeActive&&Ta(n.pointConnectionSizeActive),void 0!==n.pointConnectionSizeBy&&Vr(n.pointConnectionSizeBy),void 0!==n.pointConnectionMaxIntPointsPerSegment&&Oa(n.pointConnectionMaxIntPointsPerSegment),void 0!==n.pointConnectionTolerance&&Ba(n.pointConnectionTolerance),void 0!==n.opacityBy&&kr(n.opacityBy),void 0!==n.lassoColor&&ca(n.lassoColor),void 0!==n.lassoLineWidth&&la(n.lassoLineWidth),void 0!==n.lassoMinDelay&&ua(n.lassoMinDelay),void 0!==n.lassoMinDist&&sa(n.lassoMinDist),void 0!==n.lassoClearEvent&&da(n.lassoClearEvent),void 0!==n.lassoInitiator&&fa(n.lassoInitiator),void 0!==n.lassoInitiatorParentElement&&pa(n.lassoInitiatorParentElement),void 0!==n.keyMap&&va(n.keyMap),void 0!==n.mouseMode&&ha(n.mouseMode),void 0!==n.showReticle&&ma(n.showReticle),void 0!==n.reticleColor&&ya(n.reticleColor),void 0!==n.pointOutlineWidth&&Tr(n.pointOutlineWidth),void 0!==n.height&&Cr(n.height),void 0!==n.width&&Br(n.width),void 0!==n.aspectRatio&&gr(n.aspectRatio),void 0!==n.xScale&&ga(n.xScale),void 0!==n.yScale&&wa(n.yScale),void 0!==n.deselectOnDblClick&&xa(n.deselectOnDblClick),void 0!==n.deselectOnEscape&&ba(n.deselectOnEscape),void 0!==n.opacityByDensityFill&&za(n.opacityByDensityFill),void 0!==n.opacityInactiveMax&&La(n.opacityInactiveMax),void 0!==n.opacityInactiveScale&&ja(n.opacityInactiveScale),void 0!==n.gamma&&ka(n.gamma),new Promise((function(n){window.requestAnimationFrame((function(){h&&(yr(),Ot.refresh(),a.refresh(),lo=!0,n())}))}))},Na=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.preventEvent,o=void 0!==t&&t;aa(n),lo=!0,co=o},Va=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.showReticleOnce,r=void 0!==o&&o,i=t.preventEvent,a=void 0!==i&&i,c=!1;if(n>=0&&n<eo){c=!0;var l=Mo,u=n!==Mo;+l>=0&&u&&!$t.has(l)&&$o([l],0),Mo=n,go.subdata(Jo(n)),$t.has(n)||$o([n],2),u&&!a&&e.publish("pointover",Mo)}else(c=+Mo>=0)&&($t.has(Mo)||$o([Mo],0),a||e.publish("pointout",Mo)),Mo=void 0;c&&(lo=!0,uo=r)},Wa=function(){Ot||(Ot=E(h,{isPanInverted:[!1,!0]})),n.cameraView?Ot.setView(m(n.cameraView)):n.cameraTarget||n.cameraDistance||n.cameraRotation?Ot.lookAt(s(n.cameraTarget||Zn),n.cameraDistance||1,n.cameraRotation||0):Ot.setView(m(qn)),Gt=Go(1,1),Ht=Go(-1,-1)},Za=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.preventEvent,o=void 0!==t&&t;Wa(),Ar(),o||e.publish("view",{view:Ot.view,camera:Ot,xScale:jo,yScale:ko})},qa=function(n){switch(n.key){case"Escape":I&&Qo()}},Ga=function(){Lo=!0},Ha=function(){Va(),Lo=!1,lo=!0},Ka=function(){lo=!0},Ua=function(){Fi([]),Ft.clear()},Ya=function(){Ot.refresh();var n=At===nn,e=St===nn;if(n||e){var t=h.getBoundingClientRect(),o=t.width,r=t.height;n&&Or(o),e&&Er(r),yr(),lo=!0}},Xa=function(){return h.getContext("2d").getImageData(0,0,h.width,h.height)},$a=function(){yr(),Wa(),Ar(),Bt=_(a.regl,{color:R,width:O,is2d:!0}),Ft=_(a.regl,{color:we,colorHover:Me,colorActive:be,opacity:null===Ie?null:Ie[0],width:He[0],widthActive:Ue,is2d:!0}),Vt=_(a.regl,{color:on,width:1,is2d:!0}),Wt=_(a.regl,{color:on,width:1,is2d:!0}),Ir(),h.addEventListener("wheel",Ka),mo=a.regl.buffer(),yo=a.regl.buffer(),go=a.regl.buffer({usage:"dynamic",type:"float",length:2*en}),bo=hr(),So=pr();var n=_a({backgroundImage:p,width:At,height:St,keyMap:U});na(),window.addEventListener("keyup",qa,!1),window.addEventListener("blur",fr,!1),window.addEventListener("mouseup",lr,!1),window.addEventListener("mousemove",dr,!1),h.addEventListener("mousedown",cr,!1),h.addEventListener("mouseenter",Ga,!1),h.addEventListener("mouseleave",Ha,!1),h.addEventListener("click",ur,!1),h.addEventListener("dblclick",sr,!1),"ResizeObserver"in window?(Kt=new ResizeObserver(Ya)).observe(h):(window.addEventListener("resize",Ya),window.addEventListener("orientationchange",Ya)),n.then((function(){e.publish("init")}))},Ja=a.onFrame((function(){Oo=Ot.tick(),Bo&&(lo||Co)&&(Co&&!Ki(wo,xo)&&Ui(),Oo&&(Gt=Go(1,1),Ht=Go(-1,-1),"density"===ft&&Hi()),a.render((function(n,e){mr(n,e),p&&p._reglType&&Oi(),ro.length>2&&Bi(),Co||Ft.draw({projection:oi(),model:ii(),view:ri()}),Ei(),Yt||!Q&&!uo||Di(),Mo>=0&&Ci(),Xt.length&&Ti(),Bt.draw({projection:oi(),model:ii(),view:ri()})}),h),Oo&&(Ar(),co?co=!1:e.publish("view",{view:Ot.view,camera:Ot,xScale:jo,yScale:ko})),lo=!1,uo=!1,e.publish("draw"))})),Qa=function(){lo=!0},nc=function(){Ja(),window.removeEventListener("keyup",qa,!1),window.removeEventListener("blur",fr,!1),window.removeEventListener("mouseup",lr,!1),window.removeEventListener("mousemove",dr,!1),h.removeEventListener("mousedown",cr,!1),h.removeEventListener("mouseenter",Ga,!1),h.removeEventListener("mouseleave",Ha,!1),h.removeEventListener("click",ur,!1),h.removeEventListener("dblclick",sr,!1),Kt?Kt.disconnect():(window.removeEventListener("resize",Ya),window.removeEventListener("orientationchange",Ya)),h=void 0,Ot.dispose(),Ot=void 0,Bt.destroy(),Ft.destroy(),Vt.destroy(),Wt.destroy(),e.publish("destroy"),e.clear(),n.renderer||a.destroy()};return $a(),{clear:Ji(Ua),createTextureFromUrl:function(n){return re(a.regl,n)},deselect:Qo,destroy:nc,draw:$i,get:Fa,hover:Va,redraw:Qa,refresh:a.refresh,reset:Ji(Za),select:nr,set:_a,export:Xa,subscribe:e.subscribe,unsubscribe:e.unsubscribe,view:Na}},Object.defineProperty(n,"__esModule",{value:!0})}));
